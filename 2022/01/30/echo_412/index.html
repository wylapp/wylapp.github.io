<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 修复Python爬虫SSL错误 · 我的技术</title><meta name="description" content="修复Python爬虫SSL错误 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.svg"><link rel="stylesheet" href="/css/hermes.css"><link rel="search" type="application/opensearchdescription+xml" href="https://wylapp.github.io/atom.xml" title="我的技术"><meta name="generator" content="Hexo 6.2.0"></head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/heading.svg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">BLOG</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">FEED</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">修复Python爬虫SSL错误</h1><div class="post-info">2022年1月30日</div><div class="post-content"><!--markdown-->python的网络套接字部分依赖外部标准ssl库。一般在Windows上这个问题不大，Linux上需要正确安装`libssl`并且有可用的ssl.h头文件，这是很多问题的源头，因为有些Linux发行版使用了过时的libssl版本，解决依赖冲突会很麻烦。如果系统中的ssl库版本不符合要求，则安装后的python不能使用ssl访问（pip的使用都会受到限制）。
<span id="more"></span>
<p>在mac上我之前以为这个问题不大，因为bsd系统套接字部分的实现非常成熟，但是系统升级11.5以后就没再用过python写爬虫。今天再次写爬虫的时候发现报了很多关于ssl的错误。根本原因是缺乏本地CA证书，因此我们添加上就行了。<br>证书可以手动添加，但是有<strong>更简单的办法</strong>自动添加。<br><img src="https://pic.imgdb.cn/item/61f62f3f2ab3f51d916410a5.jpg" alt="安装目录内的工具"><br>在python安装完毕的软件目录内，双击执行<code>Install Certificates.command</code>，会自动诊断并修复本地证书错误。<br><img src="https://pic.imgdb.cn/item/61f62f852ab3f51d91645ad1.jpg" alt="安装过程"><br>至此问题解决。上述办法是查StackOverflow找到的，CSDN上没有一个答案是靠谱的！<br><em>更新</em><br>今天在Windows上写爬虫居然也出现了类似的问题，而且<strong>不能</strong>通过上述脚本自动解决，手动处理过程倒也不算太复杂。在Windows平台上出现ssl错误的环境大多使用anaconda创建。<br>首先需要确定本地证书目录：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="keyword">import</span> ssl</span><br><span class="line">&gt;&gt;&gt;ssl.get_default_verify_paths()</span><br><span class="line">DefaultVerifyPaths(cafile=<span class="string">&#x27;C:\\Program Files\\Common Files\\ssl/cert.pem&#x27;</span>, capath=<span class="literal">None</span>,</span><br><span class="line">openssl_cafile_env=<span class="string">&#x27;SSL_CERT_FILE&#x27;</span>, openssl_cafile=<span class="string">&#x27;C:\\Program Files\\Common Files\\ssl/cert.pem&#x27;</span>, openssl_capath_env=<span class="string">&#x27;SSL_CERT_DIR&#x27;</span>, openssl_capath=<span class="string">&#x27;C:\\Program Files\\Common Files\\ssl/certs&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>如果上述目录根本不存在，则手动创建到<strong>ssl目录</strong>一层。之后需要使用<code>certifi</code>模块获取合规的证书：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="keyword">import</span> certifi</span><br><span class="line">&gt;&gt;&gt;certifi.where()</span><br><span class="line"><span class="string">&#x27;D:\\Users\\admin\\anaconda3\\envs\\proj\\lib\\site-packages\\certifi\\cacert.pem&#x27;</span></span><br></pre></td></tr></table></figure>
<p>将上述<code>cacert.pem</code>文件拷贝到前述ssl文件夹即可。</p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2022/01/30/echo_413/">上一篇</a><a class="next" href="/2021/11/06/echo_363/">下一篇</a></div><div class="copyright"><p>© 2019 - 2023 <a href="https://wylapp.github.io">John Doe</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.</p><p><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">蒙ICP备20000657号</a>| <a target="_blank" rel="noopener" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=15078102000235"><img src="https://www.sohu.com/upload/images/server/ghs.png">蒙公网安备15078102000235号</a> </p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>